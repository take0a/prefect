---
title: ã‚¿ã‚¹ã‚¯ã‚’æ›¸ã„ã¦å®Ÿè¡Œã™ã‚‹
description: ã‚¿ã‚¹ã‚¯ã‚’æ›¸ãåŸºæœ¬ã‚’å­¦ã³ã¾ã™ã€‚
---

Prefect ã‚¿ã‚¹ã‚¯ã¯ã€Prefect ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«ãŠã‘ã‚‹å€‹åˆ¥ã®ä½œæ¥­å˜ä½ã§ã™ã€‚
ä»»æ„ã® Python é–¢æ•°ã« `@task` ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€ã‚¿ã‚¹ã‚¯ã«å¤‰æ›ã§ãã¾ã™ã€‚
ã‚¿ã‚¹ã‚¯ã¯æ¬¡ã®ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

- å…¥åŠ›ã‚’å—ã‘å–ã‚Šã€å‡¦ç†ã‚’å®Ÿè¡Œã—ã€å‡ºåŠ›ã‚’è¿”ã™
- å‘¼ã³å‡ºã—é–“ã§å®Ÿè¡Œã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹
- ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ­ã‚¸ãƒƒã‚¯ã‚’ã€ãƒ•ãƒ­ãƒ¼å…¨ä½“ã§å†åˆ©ç”¨å¯èƒ½ãªãƒ¦ãƒ‹ãƒƒãƒˆã«ã‚«ãƒ—ã‚»ãƒ«åŒ–ã™ã‚‹
- å®Ÿè¡Œå‰ã«ä¸Šæµã‚¿ã‚¹ã‚¯ã®ä¾å­˜é–¢ä¿‚ã¨ãã®çŠ¶æ…‹ã«é–¢ã™ã‚‹ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹
- è‡ªå‹• [ãƒ­ã‚°è¨˜éŒ²](/v3/develop/logging/) ã‚’ä½¿ç”¨ã—ã¦ã€å®Ÿè¡Œæ™‚ã®è©³ç´°ã€ã‚¿ã‚°ã€æœ€çµ‚çŠ¶æ…‹ã‚’å–å¾—ã™ã‚‹
- åŒæ™‚å®Ÿè¡Œ
- ãƒ•ãƒ­ãƒ¼ã¨åŒã˜ãƒ•ã‚¡ã‚¤ãƒ«ã§å®šç¾©ã™ã‚‹ã‹ã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹
- ãƒ•ãƒ­ãƒ¼ã¾ãŸã¯ä»–ã®ã‚¿ã‚¹ã‚¯ã‹ã‚‰å‘¼ã³å‡ºã™

ãƒ•ãƒ­ãƒ¼ã¨ã‚¿ã‚¹ã‚¯ã«ã¯ã€ã„ãã¤ã‹ã®å…±é€šç‚¹ãŒã‚ã‚Šã¾ã™:

- ãã‚Œãã‚Œã®ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¦å®šç¾©ã§ãã¾ã™ã€‚ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã¯è¨­å®šã‚’å—ã‘ä»˜ã‘ã¾ã™ã€‚
([ã‚¿ã‚¹ã‚¯è¨­å®š](/v3/develop/write-tasks/#task-configuration)ã¨[ãƒ•ãƒ­ãƒ¼è¨­å®š](/v3/develop/write-flows/#flow-settings)ã‚’å‚ç…§ã—ã¦ãã ã•ã„)
- æ•´ç†ã¨ç®¡ç†ã®ãŸã‚ã«ã€åå‰ã€èª¬æ˜ã€ã‚¿ã‚°ã‚’è¨­å®šã§ãã¾ã™ã€‚
- å†è©¦è¡Œã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã€ãã®ä»–ã®ãƒ•ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¦ã€å¤±æ•—ã‚¤ãƒ™ãƒ³ãƒˆã‚„å®Œäº†ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‡¦ç†ã§ãã¾ã™ã€‚

## ã‚¿ã‚¹ã‚¯ã®ä¾‹

1ã¤ã®ã‚¿ã‚¹ã‚¯ã‚’å«ã‚€ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ•ãƒ­ãƒ¼ã®ä¾‹ã‚’ä»¥ä¸‹ã«ç¤ºã—ã¾ã™:

```python repo_info.py
import httpx
from prefect import flow, task
from typing import Optional


@task
def get_url(url: str, params: Optional[dict[str, any]] = None):
    response = httpx.get(url, params=params)
    response.raise_for_status()
    return response.json()


@flow(retries=3, retry_delay_seconds=5, log_prints=True)
def get_repo_info(repo_name: str = "PrefectHQ/prefect"):
    url = f"https://api.github.com/repos/{repo_name}"
    repo_stats = get_url(url)
    print(f"{repo_name} repository statistics ğŸ¤“:")
    print(f"Stars ğŸŒ  : {repo_stats['stargazers_count']}")
    print(f"Forks ğŸ´ : {repo_stats['forks_count']}")


if __name__ == "__main__":
    get_repo_info()
```

ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ãã®ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ãªå‡ºåŠ›ãŒå¾—ã‚‰ã‚Œã¾ã™:

```bash
09:55:55.412 | INFO    | prefect.engine - Created flow run 'great-ammonite' for flow 'get-repo-info'
09:55:55.499 | INFO    | Flow run 'great-ammonite' - Created task run 'get_url-0' for task 'get_url'
09:55:55.500 | INFO    | Flow run 'great-ammonite' - Executing 'get_url-0' immediately...
09:55:55.825 | INFO    | Task run 'get_url-0' - Finished in state Completed()
09:55:55.827 | INFO    | Flow run 'great-ammonite' - PrefectHQ/prefect repository statistics ğŸ¤“:
09:55:55.827 | INFO    | Flow run 'great-ammonite' - Stars ğŸŒ  : 12157
09:55:55.827 | INFO    | Flow run 'great-ammonite' - Forks ğŸ´ : 1251
09:55:55.849 | INFO    | Flow run 'great-ammonite' - Finished in state Completed('All states completed.')
```

ã“ã®ã‚¿ã‚¹ã‚¯ã®å®Ÿè¡Œã¯UIã§ã‚‚è¿½è·¡ã•ã‚Œã¾ã™ã€‚

ã‚¿ã‚¹ã‚¯ã¯ã‚¿ã‚¹ã‚¯ã‚­ãƒ¼ã«ã‚ˆã£ã¦ä¸€æ„ã«è­˜åˆ¥ã•ã‚Œã¾ã™ã€‚ã‚¿ã‚¹ã‚¯ã‚­ãƒ¼ã¯ã€ã‚¿ã‚¹ã‚¯åã€é–¢æ•°ã®å®Œå…¨ä¿®é£¾åã€ãŠã‚ˆã³ã‚¿ã‚°ã§æ§‹æˆã•ã‚Œã‚‹ãƒãƒƒã‚·ãƒ¥ã§ã™ã€‚
ã‚¿ã‚¹ã‚¯ã«åå‰ãŒæŒ‡å®šã•ã‚Œã¦ã„ãªã„å ´åˆã€åå‰ã¯ãƒ‡ã‚³ãƒ¬ãƒ¼ãƒˆã•ã‚ŒãŸé–¢æ•°ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰æ´¾ç”Ÿã•ã‚Œã¾ã™ã€‚

<Note>
**ã‚¿ã‚¹ã‚¯ã¯ã©ã®ãã‚‰ã„ã®å¤§ãã•ã«ã™ã¹ãã‹ï¼Ÿ**

Prefect ã§ã¯ã€Œå°ã•ãªã‚¿ã‚¹ã‚¯ã€ã‚’æ¨å¥¨ã—ã¦ã„ã¾ã™ã€‚ãã‚Œãã‚Œã®ã‚¿ã‚¹ã‚¯ã¯ã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®è«–ç†çš„ãªã‚¹ãƒ†ãƒƒãƒ—ã‚’1ã¤ãšã¤è¡¨ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ã“ã‚Œã«ã‚ˆã‚Šã€Prefect ã¯ã‚¿ã‚¹ã‚¯ã®å¤±æ•—ã‚’ã‚ˆã‚Šé©åˆ‡ã«åˆ¶å¾¡ã—ã€ã‚ˆã‚Šãã‚ç´°ã‹ãªçµæœã®ç›£è¦–ã¨åˆ¶å¾¡ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

ã™ã¹ã¦ã®ã‚³ãƒ¼ãƒ‰ã‚’1ã¤ã®ã‚¿ã‚¹ã‚¯ã«ã¾ã¨ã‚ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚ãŸã ã—ã€ã‚³ãƒ¼ãƒ‰ã®1è¡Œã§ã‚‚å¤±æ•—ã™ã‚‹ã¨ã€ã‚¿ã‚¹ã‚¯å…¨ä½“ãŒå¤±æ•—ã—ã€æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ã‚³ãƒ¼ãƒ‰ã‚’è¤‡æ•°ã®ä¾å­˜é–¢ä¿‚ã®ã‚ã‚‹ã‚¿ã‚¹ã‚¯ã«åˆ†å‰²ã™ã‚‹ã“ã¨ã§ã€ã“ã®ã‚ˆã†ãªçŠ¶æ³ã‚’é¿ã‘ã‚‰ã‚Œã¾ã™ã€‚
</Note>


## ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹é–¢æ•°

ã»ã¼ã™ã¹ã¦ã®æ¨™æº– Python é–¢æ•°ã¯ã€`@task` ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ Prefect ã‚¿ã‚¹ã‚¯ã«å¤‰æ›ã§ãã¾ã™ã€‚

Prefect ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã®ã‚¿ã‚¹ã‚¯å®Ÿè¡Œã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ç‰¹ã«å¤šæ•°ã®ã‚¿ã‚¹ã‚¯ã‚’å«ã‚€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒå¤§å¹…ã«å‘ä¸Šã—ã¾ã™ã€‚ã‚¿ã‚¹ã‚¯ã®ä½œæˆã¨çŠ¶æ…‹ã®æ›´æ–°ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã§è¡Œã‚ã‚Œã‚‹ãŸã‚ã€å®Ÿè¡Œä¸­ã® Prefect ã‚µãƒ¼ãƒãƒ¼ã¸ã® API å‘¼ã³å‡ºã—ãŒå‰Šæ¸›ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€å¤§è¦æ¨¡ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’åŠ¹ç‡çš„ã«å‡¦ç†ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã€ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šãŒæ–­ç¶šçš„ãªå ´åˆã§ã‚‚ä¿¡é ¼æ€§ãŒå‘ä¸Šã—ã¾ã™ã€‚
<Tip>
ã‚¿ã‚¹ã‚¯ã¯ã€ç‰¹å®šã®[ã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼](/v3/develop/task-runners)ã‚’ä½¿ç”¨ã—ã¦åˆ¥ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã€ãƒ—ãƒ­ã‚»ã‚¹ã€ã¾ãŸã¯ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã§å®Ÿè¡Œã•ã‚Œãªã„é™ã‚Šã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å¸¸ã«ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
ã“ã‚Œã«ã‚ˆã‚Šã€ãƒã‚¤ãƒ†ã‚£ãƒ–Pythonã®ãƒ‡ãƒãƒƒã‚°ã¨ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°ãŒå®¹æ˜“ã«ãªã‚Šã¾ã™ã€‚
</Tip>
ã‚¿ã‚¹ã‚¯ã®æ›´æ–°ã¯ä¸€æ‹¬ã§ãƒ­ã‚°ã«è¨˜éŒ²ã•ã‚Œã‚‹ãŸã‚ã€UI ãŠã‚ˆã³ API ã‚¯ã‚¨ãƒªã«ãŠã‘ã‚‹ã‚¿ã‚¹ã‚¯çŠ¶æ…‹ã®æœ€çµ‚çš„ãªä¸€è²«æ€§ãŒç¢ºä¿ã•ã‚Œã¾ã™ã€‚
ã“ã‚Œã«ã‚ˆã‚Šã€æœ€æ–°ã®ã‚¿ã‚¹ã‚¯çŠ¶æ…‹ã®è¡¨ç¤ºã«è‹¥å¹²ã®é…å»¶ãŒç”Ÿã˜ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ãŒã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å¤§å¹…ãªå‘ä¸Šã¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼è¦æ¨¡ã®æ‹¡å¤§ãŒå®Ÿç¾ã—ã¾ã™ã€‚

### åŒæœŸé–¢æ•°

æœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ãªPrefectã‚¿ã‚¹ã‚¯ã¯ã€åŒæœŸPythoné–¢æ•°ã§ã™ã€‚
ä»¥ä¸‹ã¯ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡ºåŠ›ã™ã‚‹åŒæœŸã‚¿ã‚¹ã‚¯ã®ä¾‹ã§ã™:

```python
from prefect import task


@task
def print_message():
    print("Hello, I'm a task")


if __name__ == "__main__":
    print_message()
```

### éåŒæœŸé–¢æ•°

Prefect ã¯éåŒæœŸ Python é–¢æ•°ã‚‚ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚
çµæœã¨ã—ã¦å¾—ã‚‰ã‚Œã‚‹ã‚¿ã‚¹ã‚¯ã¯ã‚³ãƒ«ãƒ¼ãƒãƒ³ã§ã‚ã‚Šã€[æ¨™æº–çš„ãª Python ã®éåŒæœŸå‹•ä½œ](https://docs.python.org/3/library/asyncio-task.html) ã«å¾“ã£ã¦ã€å¾…æ©Ÿã¾ãŸã¯ä¸¦è¡Œå®Ÿè¡ŒãŒå¯èƒ½ã§ã™ã€‚

```python
from prefect import task
import asyncio


@task
async def print_message():
    await asyncio.sleep(1)
    print("Hello, I'm an async task")


asyncio.run(print_message())
```

### ã‚¯ãƒ©ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰

Prefect ã¯ã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ã€ã‚¯ãƒ©ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ã€é™çš„ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å«ã‚€åŒæœŸãƒ¡ã‚½ãƒƒãƒ‰ã¨éåŒæœŸãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚¿ã‚¹ã‚¯ã¨ã—ã¦ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚ã‚¯ãƒ©ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ã¨é™çš„ãƒ¡ã‚½ãƒƒãƒ‰ã®å ´åˆã¯ã€é©åˆ‡ãªãƒ¡ã‚½ãƒƒãƒ‰ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã‚’ `@task` ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã®ä¸Šã«é©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™:

```python
from prefect import task


class MyClass:

    @task
    def my_instance_method(self):
        pass


    @classmethod
    @task
    def my_class_method(cls):
        pass


    @staticmethod
    @task
    def my_static_method():
        pass


MyClass().my_instance_method()
MyClass.my_class_method()
MyClass.my_static_method()
```

### ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿

Prefect ã¯ã€åŒæœŸã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ã¨éåŒæœŸã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ã‚’ã‚¿ã‚¹ã‚¯ã¨ã—ã¦ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚
ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãŒå€¤ã‚’ç”Ÿæˆã—ã¦ã„ã‚‹é–“ã€ã‚¿ã‚¹ã‚¯ã¯ã€Œå®Ÿè¡Œä¸­ã€ã¨ã¿ãªã•ã‚Œã¾ã™ã€‚
ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãŒå€¤ã‚’ä½¿ã„åˆ‡ã‚‹ã¨ã€ã‚¿ã‚¹ã‚¯ã¯ã€Œå®Œäº†ã€ã¨ã¿ãªã•ã‚Œã¾ã™ã€‚
ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚ŒãŸå€¤ã¯ä»–ã®ã‚¿ã‚¹ã‚¯ã§ä½¿ç”¨ã§ãã€ä»–ã®ã‚¿ã‚¹ã‚¯ã¯ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ã‚¿ã‚¹ã‚¯ã‚’è¦ªã‚¿ã‚¹ã‚¯ã¨ã—ã¦è‡ªå‹•çš„ã«è¨˜éŒ²ã—ã¾ã™ã€‚

```python
from prefect import task


@task
def generator():
    for i in range(10):
        yield i


@task
def consumer(x):
    print(x)


for val in generator():
    consumer(val)
```

<Warning>
**ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿é–¢æ•°ã¯ã‚¿ã‚¹ã‚¯ã‹ã‚‰è¿”ã•ã‚ŒãŸæ™‚ç‚¹ã§æ¶ˆè²»ã•ã‚Œã¾ã™**

å®Œäº†ã—ãŸã‚¿ã‚¹ã‚¯ã®çµæœã¯ã‚·ãƒªã‚¢ãƒ«åŒ–å¯èƒ½ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ã¯ã‚·ãƒªã‚¢ãƒ«åŒ–ã§ãã¾ã›ã‚“ã€‚
ã—ãŸãŒã£ã¦ã€ã‚¿ã‚¹ã‚¯ã‹ã‚‰ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ã‚’è¿”ã™ã¨ã€ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ã¯å®Œå…¨ã«æ¶ˆè²»ã•ã‚Œã€ç”Ÿæˆã•ã‚ŒãŸå€¤ã¯ãƒªã‚¹ãƒˆã¨ã—ã¦è¿”ã•ã‚Œã¾ã™ã€‚
ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãŒç„¡é™å¤§ã¾ãŸã¯éå¸¸ã«å¤§ãã„å ´åˆã€äºˆæœŸã—ãªã„å‹•ä½œã‚„ãƒ–ãƒ­ãƒƒã‚¯ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

ä»¥ä¸‹ã¯ã€ãƒ—ãƒ­ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿æ¶ˆè²»ã®ä¾‹ã§ã™:

```python
from prefect import task


def gen():
    yield from [1, 2, 3]
    print('Generator consumed!')


@task
def f():
    return gen()


f()  # prints 'Generator consumed!'
```

ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ã‚’æ¶ˆè²»ã›ãšã«è¿”ã™å¿…è¦ãŒã‚ã‚‹å ´åˆã¯ã€`return` ã‚’ä½¿ç”¨ã™ã‚‹ä»£ã‚ã‚Šã« `yield` ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚
ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ã‚¿ã‚¹ã‚¯ã‹ã‚‰ç”Ÿæˆã•ã‚ŒãŸå€¤ã¯æœ€çµ‚çµæœã¨ã¯ã¿ãªã•ã‚Œãšã€åŒã˜ã‚·ãƒªã‚¢ãƒ«åŒ–åˆ¶ç´„ã¯é©ç”¨ã•ã‚Œã¾ã›ã‚“ã€‚

```python
from prefect import task


def gen():
    yield from [1, 2, 3]
    print('Generator consumed!')


@task
def f():
    yield gen()


generator = next(f())
list(generator) # prints 'Generator consumed!'
```
</Warning>

## åŒæ™‚å®Ÿè¡Œ

ã‚¿ã‚¹ã‚¯ã¯åŒæ™‚å®Ÿè¡Œã‚’å¯èƒ½ã«ã—ã€è¤‡æ•°ã®ã‚¿ã‚¹ã‚¯ã‚’åŒæ™‚ã«å®Ÿè¡Œã§ãã¾ã™ã€‚
ã“ã®åŒæ™‚å®Ÿè¡Œã«ã‚ˆã‚Šã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®åŠ¹ç‡ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒå¤§å¹…ã«å‘ä¸Šã—ã¾ã™ã€‚

ã‚¿ã‚¹ã‚¯ã®åŒæ™‚å®Ÿè¡Œã‚’ä¿ƒé€²ã™ã‚‹ãŸã‚ã«ã€[ã‚µãƒ³ãƒ—ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆ](/v3/develop/write-tasks/#example-task)ã‚’æ‹¡å¼µã—ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ã‚’å¢—ã‚„ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ãŸã‚Šã®ã‚ªãƒ¼ãƒ—ãƒ³èª²é¡Œã®å¹³å‡æ•°ã‚’è¨ˆç®—ã™ã‚‹ã“ã¨ã‚’æƒ³åƒã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```python repo_info.py
import httpx
from datetime import timedelta
from prefect import flow, task
from prefect.tasks import task_input_hash
from typing import Optional


@task(cache_key_fn=task_input_hash, cache_expiration=timedelta(hours=1))
def get_url(url: str, params: Optional[dict[str, any]] = None):
    response = httpx.get(url, params=params)
    response.raise_for_status()
    return response.json()


def get_open_issues(repo_name: str, open_issues_count: int, per_page: int = 100):
    issues = []
    pages = range(1, -(open_issues_count // -per_page) + 1)
    for page in pages:
        issues.append(
            get_url(
                f"https://api.github.com/repos/{repo_name}/issues",
                params={"page": page, "per_page": per_page, "state": "open"},
            )
        )
    return [i for p in issues for i in p]


@flow(retries=3, retry_delay_seconds=5, log_prints=True)
def get_repo_info(repo_name: str = "PrefectHQ/prefect"):
    repo_stats = get_url(f"https://api.github.com/repos/{repo_name}")
    issues = get_open_issues(repo_name, repo_stats["open_issues_count"])
    issues_per_user = len(issues) / len(set([i["user"]["id"] for i in issues]))
    print(f"{repo_name} repository statistics ğŸ¤“:")
    print(f"Stars ğŸŒ  : {repo_stats['stargazers_count']}")
    print(f"Forks ğŸ´ : {repo_stats['forks_count']}")
    print(f"Average open issues per user ğŸ’Œ : {issues_per_user:.2f}")


if __name__ == "__main__":
    get_repo_info()

```

ã“ã‚Œã§å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸãŒã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯é †æ¬¡å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

ã‚¿ã‚¹ã‚¯ã¯ã€å®Ÿè¡Œã‚’é †æ¬¡ã‹ã‚‰åŒæ™‚å®Ÿè¡Œã«å¤‰æ›´ã™ã‚‹ [`submit`](https://reference.prefect.io/prefect/tasks/#prefect.tasks.Task.submit) ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚
ã“ã®ä¾‹ã§ã¯ã€[`result`](https://reference.prefect.io/prefect/futures/#prefect.futures.PrefectFuture.result) ãƒ¡ã‚½ãƒƒãƒ‰ã‚‚ä½¿ç”¨ã—ã¦ã€æˆ»ã‚Šå€¤ã®ãƒªã‚¹ãƒˆã‚’å±•é–‹ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```python 
def get_open_issues(repo_name: str, open_issues_count: int, per_page: int = 100):
    issues = []
    pages = range(1, -(open_issues_count // -per_page) + 1)
    for page in pages:
        issues.append(
            get_url.submit(
                f"https://api.github.com/repos/{repo_name}/issues",
                params={"page": page, "per_page": per_page, "state": "open"},
            )
        )
    return [i for p in issues for i in p.result()]
```

<Accordion title="Logs showing concurrent task execution">

```bash
12:45:28.241 | INFO    | prefect.engine - Created flow run 'intrepid-coua' for flow 'get-repo-info'
12:45:28.311 | INFO    | Flow run 'intrepid-coua' - Created task run 'get_url-0' for task 'get_url'
12:45:28.312 | INFO    | Flow run 'intrepid-coua' - Executing 'get_url-0' immediately...
12:45:28.543 | INFO    | Task run 'get_url-0' - Finished in state Completed()
12:45:28.583 | INFO    | Flow run 'intrepid-coua' - Created task run 'get_url-1' for task 'get_url'
12:45:28.584 | INFO    | Flow run 'intrepid-coua' - Submitted task run 'get_url-1' for execution.
12:45:28.594 | INFO    | Flow run 'intrepid-coua' - Created task run 'get_url-2' for task 'get_url'
12:45:28.594 | INFO    | Flow run 'intrepid-coua' - Submitted task run 'get_url-2' for execution.
12:45:28.609 | INFO    | Flow run 'intrepid-coua' - Created task run 'get_url-4' for task 'get_url'
12:45:28.610 | INFO    | Flow run 'intrepid-coua' - Submitted task run 'get_url-4' for execution.
12:45:28.624 | INFO    | Flow run 'intrepid-coua' - Created task run 'get_url-5' for task 'get_url'
12:45:28.625 | INFO    | Flow run 'intrepid-coua' - Submitted task run 'get_url-5' for execution.
12:45:28.640 | INFO    | Flow run 'intrepid-coua' - Created task run 'get_url-6' for task 'get_url'
12:45:28.641 | INFO    | Flow run 'intrepid-coua' - Submitted task run 'get_url-6' for execution.
12:45:28.708 | INFO    | Flow run 'intrepid-coua' - Created task run 'get_url-3' for task 'get_url'
12:45:28.708 | INFO    | Flow run 'intrepid-coua' - Submitted task run 'get_url-3' for execution.
12:45:29.096 | INFO    | Task run 'get_url-6' - Finished in state Completed()
12:45:29.565 | INFO    | Task run 'get_url-2' - Finished in state Completed()
12:45:29.721 | INFO    | Task run 'get_url-5' - Finished in state Completed()
12:45:29.749 | INFO    | Task run 'get_url-4' - Finished in state Completed()
12:45:29.801 | INFO    | Task run 'get_url-3' - Finished in state Completed()
12:45:29.817 | INFO    | Task run 'get_url-1' - Finished in state Completed()
12:45:29.820 | INFO    | Flow run 'intrepid-coua' - PrefectHQ/prefect repository statistics ğŸ¤“:
12:45:29.820 | INFO    | Flow run 'intrepid-coua' - Stars ğŸŒ  : 12159
12:45:29.821 | INFO    | Flow run 'intrepid-coua' - Forks ğŸ´ : 1251
Average open issues per user ğŸ’Œ : 2.27
12:45:29.838 | INFO    | Flow run 'intrepid-coua' - Finished in state Completed('All states completed.')
```

</Accordion>

ã‚¿ã‚¹ã‚¯ã®åŒæ™‚å®Ÿè¡Œã®å®Ÿè£…ã®è©³ç´°ã«ã¤ã„ã¦ã¯ã€[ã‚¿ã‚¹ã‚¯ ãƒ©ãƒ³ãƒŠãƒ¼](/v3/develop/task-runners) ã‚¬ã‚¤ãƒ‰ã‚’ã”è¦§ãã ã•ã„ã€‚

## ã‚¿ã‚¹ã‚¯è¨­å®š

ã‚¿ã‚¹ã‚¯ã¯ã€[ã‚¿ã‚¹ã‚¯ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿](https://reference.prefect.io/prefect/tasks/#prefect.tasks.task) ã«æ¸¡ã™ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®å¼•æ•°ã‚’é€šã˜ã¦ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™ã€‚

| Argument              | Description                                                                                                                                                                                                             |
| --------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `name`                | ã‚¿ã‚¹ã‚¯ã®åå‰ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ã€‚æŒ‡å®šã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã€é–¢æ•°åã‹ã‚‰æ¨æ¸¬ã•ã‚Œã¾ã™ã€‚           |
| `description`         | ã‚¿ã‚¹ã‚¯ã®èª¬æ˜ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰æ–‡å­—åˆ—ã€‚æŒ‡å®šã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã€ãƒ‡ã‚³ãƒ¬ãƒ¼ãƒˆã•ã‚ŒãŸé–¢æ•°ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ–‡å­—åˆ—ã‹ã‚‰èª¬æ˜ãŒå–å¾—ã•ã‚Œã¾ã™ã€‚     |
| `tags`                | ã“ã®ã‚¿ã‚¹ã‚¯ã®å®Ÿè¡Œã«é–¢é€£ä»˜ã‘ã‚‰ã‚ŒãŸã‚¿ã‚°ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚»ãƒƒãƒˆã€‚ã“ã‚Œã‚‰ã®ã‚¿ã‚°ã¯ã€ã‚¿ã‚¹ã‚¯å®Ÿè¡Œæ™‚ã« `prefect.tags` ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§å®šç¾©ã•ã‚ŒãŸã‚¿ã‚°ã¨çµ„ã¿åˆã‚ã›ã‚‰ã‚Œã¾ã™ã€‚   |
| `timeout_seconds`     | ã‚¿ã‚¹ã‚¯ã®æœ€å¤§å®Ÿè¡Œæ™‚é–“ï¼ˆç§’æ•°ï¼‰ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ã§ã™ã€‚ã‚¿ã‚¹ã‚¯ãŒã“ã®å®Ÿè¡Œæ™‚é–“ã‚’è¶…ãˆã‚‹ã¨ã€å¤±æ•—ã¨ã—ã¦ãƒãƒ¼ã‚¯ã•ã‚Œã¾ã™ã€‚ |
| `cache_key_fn`        | ã‚¿ã‚¹ã‚¯ã®å®Ÿè¡Œã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨å‘¼ã³å‡ºã—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æŒ‡å®šã—ã¦æ–‡å­—åˆ—ã‚­ãƒ¼ã‚’ç”Ÿæˆã™ã‚‹ã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®å‘¼ã³å‡ºã—å¯èƒ½ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚ã‚­ãƒ¼ãŒä»¥å‰ã®å®Œäº†çŠ¶æ…‹ã¨ä¸€è‡´ã™ã‚‹å ´åˆã€ã‚¿ã‚¹ã‚¯ã‚’å†åº¦å®Ÿè¡Œã™ã‚‹ã®ã§ã¯ãªãã€ãã®çŠ¶æ…‹ã®çµæœãŒå¾©å…ƒã•ã‚Œã¾ã™ã€‚ |
| `cache_policy`        | ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ã®ç”Ÿæˆã«ä½¿ç”¨ã™ã‚‹æƒ…å ±ã‚’æ±ºå®šã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ãƒãƒªã‚·ãƒ¼ã§ã™ã€‚ä½¿ç”¨å¯èƒ½ãªãƒãƒªã‚·ãƒ¼ã¯ã€`INPUTS`ã€`TASK_SOURCE`ã€`RUN_ID`ã€`FLOW_PARAMETERS`ã€`NO_CACHE` ã§ã™ã€‚+ æ¼”ç®—å­ã‚’ä½¿ç”¨ã—ã¦çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ |
| `cache_expiration`    | ã“ã®ã‚¿ã‚¹ã‚¯ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸçŠ¶æ…‹ã‚’å¾©å…ƒã§ãã‚‹æœŸé–“ã‚’ç¤ºã™ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æ™‚é–“ã€‚æŒ‡å®šã—ãªã„å ´åˆã¯ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸçŠ¶æ…‹ã¯æœŸé™åˆ‡ã‚Œã«ãªã‚Šã¾ã›ã‚“ã€‚ |
| `retries`             | ã‚¿ã‚¹ã‚¯å®Ÿè¡ŒãŒå¤±æ•—ã—ãŸå ´åˆã«å†è©¦è¡Œã™ã‚‹å›æ•°ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ã€‚ |
| `retry_delay_seconds` | ã‚¿ã‚¹ã‚¯ãŒå¤±æ•—ã—ãŸå¾Œã«å†è©¦è¡Œã™ã‚‹ã¾ã§ã®å¾…æ©Ÿæ™‚é–“ï¼ˆç§’æ•°ï¼‰ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ã€‚ã“ã‚Œã¯ã€`retries` ãŒ 0 ä»¥å¤–ã®å ´åˆã«ã®ã¿é©ç”¨ã•ã‚Œã¾ã™ã€‚                     |
| `log_prints`| printã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã‚’ãƒ­ã‚°ã«è¨˜éŒ²ã™ã‚‹ã‹ã©ã†ã‹ã‚’ç¤ºã™ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ãƒ–ãƒ¼ãƒ«å€¤ã€‚ |

ä½¿ç”¨å¯èƒ½ãªã™ã¹ã¦ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦ã¯ã€[Python SDK ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://reference.prefect.io/prefect/tasks/#prefect.tasks.task) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

ä¾‹ãˆã°ã€ã‚¿ã‚¹ã‚¯ã«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã® `name` å¼•æ•°ã¨ `description` å¼•æ•°ã‚’æŒ‡å®šã—ã¾ã™:

```python 
@task(name="hello-task", description="This task says hello.")
def my_task():
    print("Hello, I'm a task")
```

Distinguish runs of this task by providing a `task_run_name`.  
Python's standard string formatting syntax applies:

```python
import datetime
from prefect import flow, task


@task(name="My Example Task", 
      description="An example task for a tutorial.",
      task_run_name="hello-{name}-on-{date:%A}")
def my_task(name, date):
    pass


@flow
def my_flow():
    # creates a run with a name like "hello-marvin-on-Thursday"
    my_task(name="marvin", date=datetime.datetime.now(datetime.timezone.utc))

if __name__ == "__main__":
    my_flow()
```

ã•ã‚‰ã«ã€ã“ã®è¨­å®šã§ã¯ã€ã‚¿ã‚¹ã‚¯å®Ÿè¡Œåã®æ–‡å­—åˆ—ã‚’è¿”ã™é–¢æ•°ã‚‚å—ã‘å…¥ã‚Œã¾ã™:

```python
import datetime
from prefect import flow, task


def generate_task_name():
    date = datetime.datetime.now(datetime.timezone.utc)
    return f"{date:%A}-is-a-lovely-day"


@task(name="My Example Task",
      description="An example task for the docs.",
      task_run_name=generate_task_name)
def my_task(name):
    pass


@flow
def my_flow():
    # creates a run with a name like "Thursday-is-a-lovely-day"
    my_task(name="marvin")


if __name__ == "__main__":
    my_flow()  
```

ã‚¿ã‚¹ã‚¯ã«é–¢ã™ã‚‹æƒ…å ±ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã¯ã€`prefect.runtime` ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚ä¾‹:

```python
from prefect import flow
from prefect.runtime import flow_run, task_run


def generate_task_name():
    flow_name = flow_run.flow_name
    task_name = task_run.task_name

    parameters = task_run.parameters
    name = parameters["name"]
    limit = parameters["limit"]

    return f"{flow_name}-{task_name}-with-{name}-and-{limit}"


@task(name="my-example-task",
      description="An example task for a tutorial.",
      task_run_name=generate_task_name)
def my_task(name: str, limit: int = 100):
    pass


@flow
def my_flow(name: str):
    # creates a run with a name like "my-flow-my-example-task-with-marvin-and-100"
    my_task(name="marvin")
```

## ã‚¿ã‚°

ã‚¿ã‚°ã¯ã€ã‚¿ã‚¹ã‚¯ã‚’åå‰ã‚„ãƒ•ãƒ­ãƒ¼ä»¥å¤–ã®æ–¹æ³•ã§è­˜åˆ¥ãŠã‚ˆã³ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã™ã‚‹ãŸã‚ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æ–‡å­—åˆ—ãƒ©ãƒ™ãƒ«ã§ã™ã€‚
ã‚¿ã‚°ã¯æ¬¡ã®å ´åˆã«ä¾¿åˆ©ã§ã™ã€‚

- UI ãŠã‚ˆã³ [Prefect REST API](/v3/api-ref/rest-api/#filtering) ã‚’é€šã˜ã¦ã€ã‚¿ã‚°ã§ã‚¿ã‚¹ã‚¯å®Ÿè¡Œã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã™ã‚‹ã€‚
- ã‚¿ã‚°ã§ã‚¿ã‚¹ã‚¯å®Ÿè¡Œã® [åŒæ™‚å®Ÿè¡Œåˆ¶é™](#task-run-concurrency-limits) ã‚’è¨­å®šã™ã‚‹ã€‚

[ã‚¿ã‚¹ã‚¯ ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿](https://reference.prefect.io/prefect/tasks/#prefect.tasks.task) ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å¼•æ•°ã¨ã—ã¦ã‚¿ã‚°ã‚’æŒ‡å®šã§ãã¾ã™ã€‚

```python 
@task(name="hello-task", tags=["test"])
def my_task():
    print("Hello, I'm a task")
```

ã‚ã‚‹ã„ã¯ã€[`tags` ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼](https://reference.prefect.io/prefect/context/#prefect.context.tags) ã‚’ä½¿ç”¨ã—ã¦ã€ã‚¿ã‚¹ã‚¯ã®å®šç¾©æ™‚ã§ã¯ãªãã‚¿ã‚¹ã‚¯ã®å‘¼ã³å‡ºã—æ™‚ã«ã‚¿ã‚°ã‚’æŒ‡å®šã—ã¾ã™ã€‚

```python 
from prefect import flow, task
from prefect import tags


@task
def my_task():
    print("Hello, I'm a task")


@flow
def my_flow():
    with tags("test"):
        my_task()


if __name__ == "__main__":
    my_flow()
```

## ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ

ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã¯ã€ã‚¿ã‚¹ã‚¯ãŒæ„å›³ã›ãšé•·æ™‚é–“å®Ÿè¡Œã•ã‚Œã‚‹ã®ã‚’é˜²ãã¾ã™ã€‚
ã‚¿ã‚¹ã‚¯ã®å®Ÿè¡Œæ™‚é–“ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã§æŒ‡å®šã•ã‚ŒãŸæ™‚é–“ã‚’è¶…ãˆã‚‹ã¨ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆä¾‹å¤–ãŒç™ºç”Ÿã—ã€ã‚¿ã‚¹ã‚¯ã¯å¤±æ•—ã¨ã—ã¦ãƒãƒ¼ã‚¯ã•ã‚Œã¾ã™ã€‚
UIã§ã¯ã€ã‚¿ã‚¹ã‚¯ã¯ã€ŒTimedOutã€ã¨è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ãƒ•ãƒ­ãƒ¼ã®è¦³ç‚¹ã‹ã‚‰ã¯ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ãŸã‚¿ã‚¹ã‚¯ã¯ä»–ã®å¤±æ•—ã—ãŸã‚¿ã‚¹ã‚¯ã¨åŒæ§˜ã«æ‰±ã‚ã‚Œã¾ã™ã€‚

ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“ã¯ã€ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å¼•æ•°ã€Œtimeout_secondsã€ã§æŒ‡å®šã—ã¾ã™ã€‚

```python 
from prefect import task
import time


@task(timeout_seconds=1, log_prints=True)
def show_timeouts():
    print("I will execute")
    time.sleep(5)
    print("I will not execute")
```

## å†è©¦è¡Œ

Prefect ã¯ã€å¤±æ•—ã—ãŸã‚¿ã‚¹ã‚¯å®Ÿè¡Œã‚’è‡ªå‹•çš„ã«å†è©¦è¡Œã§ãã¾ã™ã€‚
ã‚¿ã‚¹ã‚¯å®Ÿè¡Œã¯ã€Python é–¢æ•°ãŒä¾‹å¤–ã‚’ç”Ÿæˆã—ãŸå ´åˆã€_å¤±æ•—_ ã¨ãªã‚Šã¾ã™ã€‚

å†è©¦è¡Œã‚’æœ‰åŠ¹ã«ã™ã‚‹ã«ã¯ã€ã‚¿ã‚¹ã‚¯ã« `retries` å¼•æ•°ã¨ `retry_delay_seconds` å¼•æ•°ã‚’æ¸¡ã—ã¾ã™ã€‚
ã‚¿ã‚¹ã‚¯å®Ÿè¡ŒãŒå¤±æ•—ã—ãŸå ´åˆã€Prefect ã¯ `retries` å›ã¾ã§å†è©¦è¡Œã—ã€å„è©¦è¡Œã®é–“ã« `retry_delay_seconds` ç§’å¾…æ©Ÿã—ã¾ã™ã€‚
æœ€å¾Œã®å†è©¦è¡Œã§ã‚¿ã‚¹ã‚¯ãŒå¤±æ•—ã—ãŸå ´åˆã€Prefect ã¯ã‚¿ã‚¹ã‚¯ã‚’ _å¤±æ•—_ ã¨ã—ã¦ãƒãƒ¼ã‚¯ã—ã¾ã™ã€‚

ã‚¿ã‚¹ã‚¯ãŒå†è©¦è¡Œã•ã‚Œã¦ã‚‚ã€æ–°ã—ã„ã‚¿ã‚¹ã‚¯å®Ÿè¡Œã¯ä½œæˆã•ã‚Œã¾ã›ã‚“ã€‚
ä»£ã‚ã‚Šã«ã€å…ƒã®ã‚¿ã‚¹ã‚¯å®Ÿè¡Œã®çŠ¶æ…‹å±¥æ­´ã«æ–°ã—ã„çŠ¶æ…‹ãŒè¿½åŠ ã•ã‚Œã¾ã™ã€‚

å†è©¦è¡Œã¯ã€API ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ä½œæˆãªã©ã€å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ ã«ä¾å­˜ã™ã‚‹å ´åˆã«ã‚ˆãå½¹ç«‹ã¡ã¾ã™ã€‚
ä»¥ä¸‹ã®ä¾‹ã§ã¯ã€[`httpx`](https://www.python-httpx.org/) ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ã¦ HTTP ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã—ã¦ã„ã¾ã™ã€‚

```python
import httpx
from prefect import flow, task


@task(retries=2, retry_delay_seconds=5)
def get_data_task(
    url: str = "https://api.brittle-service.com/endpoint"
) -> dict:
    response = httpx.get(url)
    
    # If the response status code is anything but a 2xx, httpx will raise
    # an exception. This task doesn't handle the exception, so Prefect will
    # catch the exception and will consider the task run failed.
    response.raise_for_status()
    
    return response.json()
    

@flow
def get_data_flow():
    get_data_task()


if __name__ == "__main__":
    get_data_flow()
```

ã“ã®ã‚¿ã‚¹ã‚¯ã§ã¯ã€è„†å¼±ãª API ã¸ã® HTTP è¦æ±‚ãŒ 2xx (200ã€201 ãªã©) ä»¥å¤–ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ ã‚³ãƒ¼ãƒ‰ã‚’å—ä¿¡ã™ã‚‹ã¨ã€Prefect ã¯ã‚¿ã‚¹ã‚¯ã‚’æœ€å¤§ 2 å›å†è©¦è¡Œã—ã€å†è©¦è¡Œã®é–“ã« 5 ç§’é–“å¾…æ©Ÿã—ã¾ã™ã€‚

### ã‚«ã‚¹ã‚¿ãƒ å†è©¦è¡Œå‹•ä½œ

`retry_delay_seconds` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ã€å†è©¦è¡Œå‹•ä½œã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹ãŸã‚ã®æ•´æ•°ã®ãƒªã‚¹ãƒˆã‚’å—ã‘å…¥ã‚Œã¾ã™ã€‚
æ¬¡ã®ã‚¿ã‚¹ã‚¯ã¯ã€æ¬¡ã®è©¦è¡Œã‚’é–‹å§‹ã™ã‚‹å‰ã«ã€ãã‚Œãã‚Œ 1 ç§’ã€10 ç§’ã€100 ç§’ã¨é€£ç¶šã—ã¦å¢—åŠ ã™ã‚‹é–“éš”ã§å¾…æ©Ÿã—ã¾ã™ã€‚

```python
from prefect import task


@task(retries=3, retry_delay_seconds=[1, 10, 100])
def some_task_with_manual_backoff_retries():
   (rest of code follows)
```

`retry_condition_fn` å¼•æ•°ã«ã¯ã€ãƒ–ãƒ¼ãƒ«å€¤ã‚’è¿”ã™å‘¼ã³å‡ºã—å¯èƒ½ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æŒ‡å®šã—ã¾ã™ã€‚
å‘¼ã³å‡ºã—å¯èƒ½ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒ `True` ã‚’è¿”ã™å ´åˆã€ã‚¿ã‚¹ã‚¯ã¯å†è©¦è¡Œã•ã‚Œã¾ã™ã€‚
å‘¼ã³å‡ºã—å¯èƒ½ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒ `False` ã‚’è¿”ã™å ´åˆã€ã‚¿ã‚¹ã‚¯ã¯å†è©¦è¡Œã•ã‚Œã¾ã›ã‚“ã€‚
å‘¼ã³å‡ºã—å¯èƒ½ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ã€ã‚¿ã‚¹ã‚¯ã€å®Ÿè¡Œã•ã‚Œã‚‹ã‚¿ã‚¹ã‚¯ã€ãŠã‚ˆã³å®Ÿè¡Œã•ã‚Œã‚‹ã‚¿ã‚¹ã‚¯ã®çŠ¶æ…‹ã¨ã„ã† 3 ã¤ã®å¼•æ•°ã‚’æŒ‡å®šã—ã¾ã™ã€‚
æ¬¡ã®ã‚¿ã‚¹ã‚¯ã¯ã€401 ã¾ãŸã¯ 404 ä»¥å¤–ã® HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã§å†è©¦è¡Œã—ã¾ã™:

```python
import httpx
from prefect import flow, task


def retry_handler(task, task_run, state) -> bool:
    """Custom retry handler that specifies when to retry a task"""
    try:
        # Attempt to get the result of the task
        state.result()
    except httpx.HTTPStatusError as exc:
        # Retry on any HTTP status code that is not 401 or 404
        do_not_retry_on_these_codes = [401, 404]
        return exc.response.status_code not in do_not_retry_on_these_codes
    except httpx.ConnectError:
        # Do not retry
        return False
    except:
        # For any other exception, retry
        return True


@task(retries=1, retry_condition_fn=retry_handler)
def my_api_call_task(url):
    response = httpx.get(url)
    response.raise_for_status()
    return response.json()


@flow
def get_data_flow(url):
    my_api_call_task(url=url)


if __name__ == "__main__":
    get_data_flow(url="https://httpbin.org/status/503")
```

ã•ã‚‰ã«ã€å†è©¦è¡Œå›æ•°ã‚’å¼•æ•°ã¨ã—ã¦å—ã‘å–ã‚Šã€ãƒªã‚¹ãƒˆã‚’è¿”ã™å‘¼ã³å‡ºã—å¯èƒ½ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¸¡ã™ã“ã¨ã‚‚ã§ãã¾ã™ã€‚
Prefect ã«ã¯ã€[`exponential_backoff`](https://reference.prefect.io/prefect/tasks/#prefect.tasks.exponential_backoff) ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãŒå«ã¾ã‚Œã¦ãŠã‚Šã€æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•å†è©¦è¡Œæˆ¦ç•¥ã«å¯¾å¿œã™ã‚‹å†è©¦è¡Œé…å»¶ã®ãƒªã‚¹ãƒˆã‚’è‡ªå‹•çš„ã«ç”Ÿæˆã—ã¾ã™ã€‚
æ¬¡ã®ãƒ•ãƒ­ãƒ¼ã¯ã€å„å†è©¦è¡Œã®å‰ã« 10 ç§’ã€20 ç§’ã€ãã—ã¦ 40 ç§’å¾…æ©Ÿã—ã¾ã™ã€‚

```python
from prefect import task
from prefect.tasks import exponential_backoff


@task(retries=3, retry_delay_seconds=exponential_backoff(backoff_factor=10))
def some_task_with_exponential_backoff_retries():
   (rest of code follows)
```

#### ã‚¸ãƒƒã‚¿ãƒ¼ã‚’è¿½åŠ ã—ã¦ã€Œã‚µãƒ³ãƒ€ãƒ¼ãƒªãƒ³ã‚°ãƒ»ãƒãƒ¼ã‚ºã€ã‚’å›é¿

å†è©¦è¡Œé…å»¶æ™‚é–“ã« _jitter_ ã‚’è¿½åŠ ã§ãã¾ã™ã€‚
ã‚¸ãƒƒã‚¿ãƒ¼ã¨ã¯ã€å†è©¦è¡ŒæœŸé–“ã«è¿½åŠ ã•ã‚Œã‚‹ãƒ©ãƒ³ãƒ€ãƒ ãªæ™‚é–“é‡ã§ã€ã€Œã‚µãƒ³ãƒ€ãƒ¼ãƒªãƒ³ã‚°ãƒ»ãƒãƒ¼ã‚ºã€ã‚·ãƒŠãƒªã‚ªï¼ˆå¤šæ•°ã®ã‚¿ã‚¹ã‚¯ãŒåŒæ™‚ã«å†è©¦è¡Œã—ã€ã‚·ã‚¹ãƒ†ãƒ ã«éè² è·ã‚’ã‹ã‘ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹çŠ¶æ…‹ï¼‰ã‚’é˜²ãã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚

`retry_jitter_factor` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€åŸºæœ¬é…å»¶ã«å¤‰å‹•ã‚’åŠ ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ä¾‹ãˆã°ã€å†è©¦è¡Œé…å»¶ã‚’ 10 ç§’ã«è¨­å®šã—ã€`retry_jitter_factor` ã‚’ 0.5 ã«è¨­å®šã™ã‚‹ã¨ã€æœ€å¤§ 15 ç§’ã®é…å»¶ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚
`retry_jitter_factor` ã®å€¤ã‚’å¤§ããã™ã‚‹ã¨ã€ã€Œã‚µãƒ³ãƒ€ãƒ¼ãƒªãƒ³ã‚°ãƒ»ãƒãƒ¼ã‚ºã€ã«å¯¾ã™ã‚‹ä¿è­·ãŒå¼·åŒ–ã•ã‚Œã€å¹³å‡å†è©¦è¡Œé…å»¶æ™‚é–“ã¯ä¸€å®šã«ä¿ãŸã‚Œã¾ã™ã€‚
ä¾‹ãˆã°ã€æ¬¡ã®ã‚¿ã‚¹ã‚¯ã¯æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ã«ã‚¸ãƒƒã‚¿ãƒ¼ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€å†è©¦è¡Œé…å»¶ãŒãã‚Œãã‚Œæœ€å¤§ 20 ç§’ã€40 ç§’ã€80 ç§’ã¾ã§å¤‰å‹•ã—ã¾ã™ã€‚

```python
from prefect import task
from prefect.tasks import exponential_backoff


@task(
    retries=3,
    retry_delay_seconds=exponential_backoff(backoff_factor=10),
    retry_jitter_factor=1,
)


def some_task_with_exponential_backoff_retries():
   (rest of code follows)
```

#### å†è©¦è¡Œå‹•ä½œã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«è¨­å®šã™ã‚‹

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å†è©¦è¡Œå›æ•°ã¨å†è©¦è¡Œé…å»¶æ™‚é–“ã‚’è¨­å®šã‚’é€šã˜ã¦ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«è¨­å®šã—ã¾ã™ã€‚
ã“ã‚Œã‚‰ã®è¨­å®šã¯ã€ã‚¿ã‚¹ã‚¯ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã§è¨­å®šã•ã‚ŒãŸ `retries` ã¾ãŸã¯ `retry_delay_seconds` ã‚’ä¸Šæ›¸ãã—ã¾ã›ã‚“ã€‚

```
prefect config set PREFECT_TASK_DEFAULT_RETRIES=2
prefect config set PREFECT_TASK_DEFAULT_RETRY_DELAY_SECONDS = [1, 10, 100]
```


## ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿æ§‹æ–‡

ã‚¿ã‚¹ã‚¯ã‚’å®šç¾©ã™ã‚‹ã«ã¯ã€é€šå¸¸ã¯ `@task` ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™:

```python
from prefect import task

@task
def my_static_task(): ...
```

å¿…è¦ã«å¿œã˜ã¦ã€å‘¼ã³å‡ºã—å¯èƒ½ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã§ `task` ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¦ã€ã‚¿ã‚¹ã‚¯ã‚’å³åº§ã«ä½œæˆã§ãã¾ã™:

```python
from prefect import flow, task

@flow
def dynamic_flow() -> list[int]:
    return task(name="dynamic-task")(lambda x: x + 1).map([1, 2, 3]).result()

assert dynamic_flow() == [2, 3, 4]
```

ã“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã‚ˆã‚Šç¾å®Ÿçš„ãªä¾‹ã«ã¤ã„ã¦ã¯ã€[ã‚¿ã‚¹ã‚¯ ãƒ©ãƒ³ãƒŠãƒ¼](/v3/develop/task-runners/#nested-mapped-tasks) ã‚¬ã‚¤ãƒ‰ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚